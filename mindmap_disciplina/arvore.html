<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <title>Mapa Mental Interativo com jsMind</title>
  <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsmind@0.4.6/style/jsmind.css" />
  <script src="https://cdn.jsdelivr.net/npm/jsmind@0.4.6/js/jsmind.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsmind@0.4.6/js/jsmind.draggable.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    #jsmind_container {
      width: 100%;
      height: 800px;
      border: solid 1px #ccc;
      background: #f4f4f4;
    }
  </style>
</head>
<body>
  <h2>Árvore Interativa - Conteúdo (jsMind)</h2>
  <button onclick="exportarImagem()">📷 Exportar Imagem</button>

  <div id="jsmind_container"></div>

  <script>
    let jsonData = __JSON_PLACEHOLDER__;

    function convertToJsMind(node, parentId = null, nodes = []) {
      const id = Math.random().toString(36).substr(2, 9);
      const nodeData = {
        id: id,
        isroot: parentId === null,
        topic: node.name,
        parentid: parentId
      };
      nodes.push(nodeData);
      if (node.children) {
        for (const child of node.children) {
          convertToJsMind(child, id, nodes);
        }
      }
      return nodes;
    }

    const nodeArray = convertToJsMind(jsonData);
    const mindData = {
      meta: {
        name: "mapa_mental",
        author: "gpt",
        version: "1.0"
      },
      format: "node_array",
      data: nodeArray
    };

    const options = {
      container: 'jsmind_container',
      editable: false,
      theme: 'primary'
    };

    const jm = new jsMind(options);
    jm.show(mindData);

    function exportarImagem() {
      const container = document.getElementById('jsmind_container');
      html2canvas(container).then(canvas => {
        const link = document.createElement('a');
        link.download = 'mapa_mental.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }
  </script>
</body>
</html>